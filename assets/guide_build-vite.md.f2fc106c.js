import{o as n,c as s,a}from"./app.7716e933.js";const e='{"title":"build\\\\vite\\\\plugin","description":"","frontmatter":{},"headers":[{"level":3,"title":"Vite配置-server.hmr","slug":"vite配置-server-hmr"},{"level":3,"title":"Vite配置-build.minify","slug":"vite配置-build-minify"},{"level":3,"title":"Vite配置-build.brotlisize","slug":"vite配置-build-brotlisize"},{"level":3,"title":"Vite配置-build.chunksizewarninglimit","slug":"vite配置-build-chunksizewarninglimit"},{"level":3,"title":"Vite配置- css.preprocessorOptions","slug":"vite配置-css-preprocessoroptions"},{"level":3,"title":"@vitejs-plugin-vue-jsx","slug":"vitejs-plugin-vue-jsx"},{"level":3,"title":"@vitejs/plugin-legacy","slug":"vitejs-plugin-legacy"},{"level":3,"title":"vite-plugin-html","slug":"vite-plugin-html"}],"relativePath":"guide/build-vite.md","lastUpdated":1631172204159}',t={},p=a('<h1 id="build-vite-plugin"><a class="header-anchor" href="#build-vite-plugin" aria-hidden="true">#</a> build\\vite\\plugin</h1><h3 id="vite配置-server-hmr"><a class="header-anchor" href="#vite配置-server-hmr" aria-hidden="true">#</a> <a href="https://cn.vitejs.dev/config/#server-hmr" target="_blank" rel="noopener noreferrer">Vite配置-server.hmr</a></h3><p>禁用或配置 HMR 连接（用于 HMR websocket 必须使用不同的 http 服务器地址的情况）。</p><p>设置 server.hmr.overlay 为 false 可以禁用服务器错误遮罩层。</p><p>这个就是配置Vite的热更新的。文档中说的服务器错误遮罩层，就是你在代码中编写编写错误的代码，编译不通过的时候，浏览器页面也会同时展示一个灰屏上面显示你的代码错误。</p><p>build\\vite\\plugin</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> configHmrPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./hmr&#39;</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// TODO</span>\n  <span class="token operator">!</span>isBuild <span class="token operator">&amp;&amp;</span> vitePlugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">configHmrPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre></div><h3 id="vite配置-build-minify"><a class="header-anchor" href="#vite配置-build-minify" aria-hidden="true">#</a> <a href="https://cn.vitejs.dev/config/#build-minify" target="_blank" rel="noopener noreferrer">Vite配置-build.minify</a></h3><p>默认为 Terser，虽然 <a href="https://github.com/terser/terser" target="_blank" rel="noopener noreferrer">Terser</a> 相对较慢，但大多数情况下构建后的文件体积更小。ESbuild 最小化混淆更快但构建后的文件相对更大</p><p>其实不用配置，默认即可。</p><p>build\\vite\\plugin</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> configHtmlPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./html&#39;</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// vite-plugin-html</span>\n  vitePlugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">configHtmlPlugin</span><span class="token punctuation">(</span>viteEnv<span class="token punctuation">,</span> isBuild<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre></div><p>vite.config.ts</p><div class="language-js"><pre><code>build<span class="token operator">:</span> <span class="token punctuation">{</span>\n    terserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>\n    compress<span class="token operator">:</span> <span class="token punctuation">{</span>\n        keep_infinity<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 通过true以防止Infinity被压缩为1/0，这可能会导致Chrome出现性能问题。</span>\n        <span class="token comment">// Used to delete console in production environment 用于删除生产环境中的console</span>\n        drop_console<span class="token operator">:</span> <span class="token constant">VITE_DROP_CONSOLE</span><span class="token punctuation">,</span> <span class="token comment">// -传递true以放弃对console.*函数的调用。 .env.development false | .env.production : true</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n</code></pre></div><h3 id="vite配置-build-brotlisize"><a class="header-anchor" href="#vite配置-build-brotlisize" aria-hidden="true">#</a> <a href="https://cn.vitejs.dev/config/#build-brotlisize" target="_blank" rel="noopener noreferrer">Vite配置-build.brotlisize</a></h3><p>启用/禁用 brotli 压缩大小报告。压缩大型输出文件可能会很慢，因此禁用该功能可能会提高大型项目的构建性能。</p><p>禁用就好。</p><p>vite.config.ts</p><div class="language-js"><pre><code>build<span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token operator">...</span>   \n    <span class="token comment">// Turning off brotliSize display can slightly reduce packaging time</span>\n    brotliSize<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n</code></pre></div><h3 id="vite配置-build-chunksizewarninglimit"><a class="header-anchor" href="#vite配置-build-chunksizewarninglimit" aria-hidden="true">#</a> <a href="https://cn.vitejs.dev/config/#build-chunksizewarninglimit" target="_blank" rel="noopener noreferrer">Vite配置-build.chunksizewarninglimit</a></h3><p>在编写代码时，您可能已经添加了许多代码拆分点以按需加载内容。编译后，您可能会注意到一些块太小了-造成更大的HTTP开销。LimitChunkCountPlugin可以通过合并来对您的块进行后处理。</p><p>vite.config.ts</p><div class="language-js"><pre><code>build<span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token operator">...</span>   \n    chunkSizeWarningLimit<span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>\n</code></pre></div><h3 id="vite配置-css-preprocessoroptions"><a class="header-anchor" href="#vite配置-css-preprocessoroptions" aria-hidden="true">#</a> <a href="https://www.pipipi.net/vite/config/#css-preprocessoroptions" target="_blank" rel="noopener noreferrer">Vite配置- css.preprocessorOptions</a></h3><p>指定传递给 CSS 预处理器的选项。</p><p>vite.config.ts</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> generateModifyVars <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./build/generate/generateModifyVars&#39;</span><span class="token punctuation">;</span>\ncss<span class="token operator">:</span> <span class="token punctuation">{</span>\n    preprocessorOptions<span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 用于全局导入，以避免需要单独导入每个样式文件。</span>\n        less<span class="token operator">:</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 在全局less文件后面添加变量的配置。modifyVars对应的对象属性名会加上@追加到less文件后。</span>\n            modifyVars<span class="token operator">:</span> <span class="token function">generateModifyVars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n</code></pre></div><p>Antd框架使用的是<code>less</code><br><code>src\\design\\index.less</code>：全局样式，在<code>main.ts</code>中使用。<br><code>src\\design\\config.less</code>：全局变量，在<code>vite.config.ts</code>中使用。</p><p><a href="https://www.kuxiaoxin.com/archives/57" target="_blank" rel="noopener noreferrer">Vite的颜色</a></p><p>build\\config\\themeConfig.ts</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getThemeColors</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">,</span> theme<span class="token operator">?</span><span class="token operator">:</span> ThemeMode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> tc <span class="token operator">=</span> color <span class="token operator">||</span> primaryColor<span class="token punctuation">;</span>\n  <span class="token keyword">const</span> tm <span class="token operator">=</span> theme <span class="token operator">||</span> themeMode<span class="token punctuation">;</span>\n  <span class="token comment">// ↓传入的颜色根据主题生成10个颜色系列</span>\n  <span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token function">generateAntColors</span><span class="token punctuation">(</span>tc<span class="token punctuation">,</span> tm<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// ↓取10个颜色的第6个作为主颜色</span>\n  <span class="token keyword">const</span> primary <span class="token operator">=</span> colors<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token comment">// ↓再使用主颜色根据主题生成10个颜色系列</span>\n  <span class="token keyword">const</span> modeColors <span class="token operator">=</span> <span class="token function">generateAntColors</span><span class="token punctuation">(</span>primary<span class="token punctuation">,</span> tm <span class="token operator">===</span> <span class="token string">&#39;dark&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;light&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;dark&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// ↓输出这20个颜色</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>colors<span class="token punctuation">,</span> <span class="token operator">...</span>modeColors<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h3 id="vitejs-plugin-vue-jsx"><a class="header-anchor" href="#vitejs-plugin-vue-jsx" aria-hidden="true">#</a> @vitejs-plugin-vue-jsx</h3><p>为什么使用JSX?</p><p>其实JSX的效果和我们在vue的template中写的代码效果是一样的。最终都会被渲染成<code>createElement</code>。</p><p>区别是<code>template</code>的标签是不可变的，我们要实现动态标签，只能使用<code>v-if</code>。而JSX的最大特点就是灵活，我们可以随意组装HTML代码。 假如我们要实现一个组件渲染<code>&lt;hn&gt;&lt;/hn&gt;</code>标签，n是我们传入的参数。如果用template，那么我们要写6个v-if。但是如果使用JSX，我们就可以直接将n放到标签中去。</p><h3 id="vitejs-plugin-legacy"><a class="header-anchor" href="#vitejs-plugin-legacy" aria-hidden="true">#</a> @vitejs/plugin-legacy</h3><p>注：此插件需要<code>vite@^2.0.0-beta.12</code>。</p><p>Vite默认的浏览器支持基线是原生<code>ESM</code>。本插件为不支持原生ESM的传统浏览器提供支持。 这个是一个浏览器兼容的插件。</p><div class="language-js"><pre><code><span class="token keyword">import</span> legacy <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-legacy&#39;</span><span class="token punctuation">;</span>\n\n<span class="token comment">// @vitejs/plugin-legacy</span>\n<span class="token constant">VITE_LEGACY</span> <span class="token operator">&amp;&amp;</span> isBuild <span class="token operator">&amp;&amp;</span> vitePlugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">legacy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre></div><h3 id="vite-plugin-html"><a class="header-anchor" href="#vite-plugin-html" aria-hidden="true">#</a> vite-plugin-html</h3><p>一个为index.html提供<code>minify</code>和基于<code>EJS</code>模板功能的Vite插件。<br><code>minify</code>：压缩index.html代码。<br><code>EJS</code>：给index.html提供访问变量的能力。</p>',41);t.render=function(a,e,t,o,c,i){return n(),s("div",null,[p])};export default t;export{e as __pageData};
